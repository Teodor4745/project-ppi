<div class="container">
    <h2 id="animals" class="text-center mt-5 fs-2">Домашни любимци</h2>
    <div class="row">
      <div class="col-lg-3 mt-4 px-2 d-flex align-items-center">
        <div class="dropdown">
          <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
            Филтрирай по категория
          </button>
          <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton">
            <li *ngFor="let category of animalCategories">
              <a class="dropdown-item" href="#" (click)="filterByAnimalCategory($event, category)">{{ category }}</a>
            </li>
          </ul>
        </div>
        <p class="ps-2 fs-5 fw-bold m-0">
          {{currentFilter}}
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-12 col-md-6 col-xl-3 my-4 px-2" *ngFor="let animal of animals">
        <div class="card w-100" style="width: 18rem;">
          <img class="w-100" class="product-img" src="http://localhost:8000/{{animal.image}}" alt="Снимката не беше заредена">
          <div class="card-body d-flex flex-column justify-content-between">
            <h5 class="card-title mb-1 fs-6">{{ animal.title ?? 'Домашен любимец' }}</h5>
            <h3 class="color-green">{{animal.price + 'лв.'}}</h3>
            <div class="action-row d-flex justify-content-between mt-3">
              <button class="btn btn-custom-primary" (click)="selectProduct(animal)">Виж</button>
              <button *ngIf="isAdmin" class="btn btn-danger" (click)="removeProduct(animal)">
                <i class="fa-solid fa-trash text-white"></i>
            </button>
            </div>
          </div>
        </div>  
      </div>
      <div class="alert alert-warning d-flex align-items-center mt-3" role="alert" *ngIf="!this.animals.length">
        <i class="fa-solid fa-triangle-exclamation me-2"></i>
        Няма намерени резултати
      </div>
    </div>

    <h2 id="food" class="text-center mt-5 fs-2">Храна</h2>
    <div class="row">
      <div class="col-12 col-md-6 col-xl-3 my-4 px-2" *ngFor="let food of foods">
        <div class="card w-100" style="width: 18rem;">
          <img class="w-100" class="product-img" src="http://localhost:8000/{{food.image}}" alt="Снимката не беше заредена">
          <div class="card-body d-flex flex-column justify-content-between">
            <h5 class="card-title mb-1 fs-6">{{ food.title ?? 'Храна' }}</h5>
            <h3 class="color-green">{{food.price + 'лв.'}}</h3>
            <div class="action-row d-flex justify-content-between">
              <button class="btn btn-custom-primary" (click)="selectProduct(food)">Виж</button>
              <button *ngIf="isAdmin" class="btn btn-danger" (click)="removeProduct(food)">
                  <i class="fa-solid fa-trash text-white"></i>
              </button>
            </div>
          </div>
        </div>  
      </div><div class="alert alert-warning d-flex align-items-center mt-3" role="alert" *ngIf="!this.foods.length">
        <i class="fa-solid fa-triangle-exclamation me-2"></i>
        Няма намерени резултати
      </div>
    </div>

    <h2 id="accessories" class="text-center mt-5 fs-2">Аксесоари</h2>
    <div class="row">
      <div class="col-12 col-md-6 col-xl-3 my-4 px-2" *ngFor="let accessory of accessories">
        <div class="card w-100" style="width: 18rem;">
          <img class="w-100" class="product-img" src="http://localhost:8000/{{accessory.image}}" alt="Снимката не беше заредена">
          <div class="card-body d-flex flex-column justify-content-between">
            <h5 class="card-title mb-1 fs-6">{{ accessory.title ?? 'Аксесоар' }}</h5>
            <h3 class="color-green">{{accessory.price + 'лв.'}}</h3>
            <div class="action-row d-flex justify-content-between">
              <button class="btn btn-custom-primary" (click)="selectProduct(accessory)">Виж</button>
              <button *ngIf="isAdmin" class="btn btn-danger" (click)="removeProduct(accessory)">
                <i class="fa-solid fa-trash text-white"></i>
              </button>
            </div>
          </div>
        </div>  
      </div>
    </div>
    <div class="alert alert-warning d-flex align-items-center my-3" role="alert" *ngIf="!this.accessories.length">
      <i class="fa-solid fa-triangle-exclamation me-2"></i>
      Няма намерени резултати
    </div>
</div>

<div class="floating-menu position-fixed p-3">
  <div class="btn-group-vertical" role="group" aria-label="Quick navigation">
    <button type="button" class="btn btn-custom-primary m-0" (click)="scrollTo('animals')">Домашни любимци</button>
    <button type="button" class="btn btn-custom-primary m-0" (click)="scrollTo('food')">Храна</button>
    <button type="button" class="btn btn-custom-primary m-0" (click)="scrollTo('accessories')">Аксесоари</button>
  </div>
</div>

<p-dialog [header]="this.selectedProduct?.title" [(visible)]="isProductSelected" [style]="{width: '50vw'}">
  <div class="text-center">
    <img class="w-100" class="dialog-img w-100" [src]="this.selectedProductImage" alt="Снимката не е налична">
  </div>
  <p class="mt-3">
      {{ this.selectedProduct?.description }}
  </p>
  <h3 class="color-green">{{this.selectedProduct?.price + 'лв.'}}</h3>
  
  <div *ngIf="this.selectedProductType === 'Животно'" class="alert alert-primary d-flex align-items-center" role="alert">
    <i class="fa-solid fa-circle-info"></i>
    <div class="ps-2">
      Домашните любимци могат да бъдат закупени само присъствено в нашия магазин.
    </div>
  </div>

  <div *ngIf="!isAdmin && selectedProductType !== 'Животно'">
    <button class="btn btn-custom-primary" (click)="addToCart(selectedProduct)">
      <i class="fa-solid fa-plus"></i>
      Добави в количка
    </button>
  </div>

  <div *ngIf="showSuccessMessage" class="alert alert-success mt-3">
    Продуктът беше добавен успешно!
  </div>
</p-dialog>

<div *ngIf="order.products.length" class="shopping-cart" (click)="goToOrderBtn()">
  <i class="fa-solid fa-shopping-cart"></i>
  <div class="pulse-ring"></div>
  <div class="position-relative">
    <span class="count">{{order.products.length}}</span>
  </div>
</div>


<p-dialog header="Количка" [(visible)]="isCartDialogVisible" [style]="{width: '80vw'}">
  <div *ngFor="let item of order.products; let i = index">
    <div class="d-flex justify-content-between align-items-center">
      <img [src]="item.image" alt="{{item.title}}" style="width: 50px; height: auto;">
      <span>{{ item.title }}</span>
      <span>{{ item.price }} лв.</span>
      <button class="btn btn-custom-primary" (click)="increaseQuantity(i)">+</button>
      <span>{{ item.quantity }}</span>
      <button class="btn btn-custom-primary" (click)="decreaseQuantity(i)">-</button>
      <button class="btn btn-danger" (click)="removeItemFromCart(i)">Премахни</button>
    </div>
  </div>
  <button *ngIf="!isLoggedIn" class="btn btn-primary" (click)="openRegistrationDialog()">Регистрация</button>
  <ng-container *ngIf="isLoggedIn">
    <div class="form-group">
      <label for="shippingType">Изберете метод на доставка:</label>
      <select class="form-control" id="shippingType" [(ngModel)]="order.shippingTypeId" name="shippingType">
        <option *ngFor="let type of shippingTypes" [value]="type.id">{{ type.description }}</option>
      </select>
    </div>

    <button class="btn btn-custom-primary mt-5" (click)="makeOrder()">Направи поръчка</button>
  </ng-container>
</p-dialog>

<p-dialog header="Регистрация" [(visible)]="isRegistrationDialogVisible" [style]="{width: '30vw'}">
  <form (ngSubmit)="registerUser()">
    <!-- Form fields for registration -->
    <input type="text" [(ngModel)]="newUser.username" name="username" placeholder="Потребителско име" class="form-control" required>
    <input type="password" [(ngModel)]="newUser.password" name="password" placeholder="Парола" class="form-control" required>
    <button type="submit" class="btn btn-success">Регистрирай се</button>
  </form>
</p-dialog>

